/// An extension trait for `bool` that provides conversion methods to [`Result`] and [`Option`].
///
/// This trait allows transforming boolean values into [`Result`] or [`Option`] types,
/// making it easy to use boolean conditions with the `?` operator for early returns.
#[sealed::sealed]
pub trait Then {
    /// Returns [`Err`] if the `bool` value is `true`, and [`Ok(())`](Ok) otherwise.
    ///
    /// This is useful for allowing an early return from a method that returns [`Result`] via
    /// the `?` operator. Or for concisely transforming a boolean guard into a [`Result`].
    ///
    /// # Arguments
    ///
    /// * `err` - The value to return as [`Err`] if the `bool` value is `true`.
    ///
    /// Note this value is eagerly evaluated, for a lazily evaluated version see [`Then::then_err_with`].
    ///
    /// # Errors
    ///
    /// Returns [`Err`] if the `bool` value is `true`, and [`Ok(())`](Ok) otherwise.
    ///
    /// # Example
    ///
    /// ```rust
    /// use fluent_result::bool::Then;
    ///
    /// let result = true.then_err("error");
    /// assert_eq!(result, Err("error"));
    ///
    /// let result = false.then_err("error");
    /// assert_eq!(result, Ok(()));
    /// ```
    fn then_err<E>(self, err: E) -> Result<(), E>;

    /// Runs `factory` to create an [`Err`] value and returns it if the `bool` value is `true`,
    /// or returns [`Ok(())`](Ok) otherwise.
    ///
    /// This is useful for allowing an lazily evaluated early return from a method that returns
    /// [`Result`] via the `?` operator. Or for concisely transforming a boolean guard into a
    /// [`Result`].
    ///
    /// # Arguments
    ///
    /// * `factory` - A function that returns the value to return as [`Err`] if the `bool`
    /// value is `true`.
    ///
    /// Note this value is lazily evaluated, for an eagerly evaluated version see [`Then::then_err`].
    ///
    /// # Errors
    ///
    /// Returns the value generated by `factory` as [`Err`] if the `bool` value is `true`,
    /// or [`Ok(())`](Ok) otherwise.
    ///
    /// # Example
    ///
    /// ```rust
    /// use fluent_result::bool::Then;
    ///
    /// let result = true.then_err_with(|| "error");
    /// assert_eq!(result, Err("error"));
    ///
    /// let result = false.then_err_with(|| "error");
    /// assert_eq!(result, Ok(()));
    /// ```
    fn then_err_with<E, F>(self, factory: F) -> Result<(), E>
    where
        F: FnOnce() -> E;

    /// Returns [`Ok(on_true)`](Ok) if the `bool` value is `true`, and [`Err(on_false)`](Err)
    /// otherwise.
    ///
    /// This is equivalent to `if self { Ok(on_true) } else { Err(on_false) }`, but may be more
    /// convienent for some expressions. It also allows for early returns from methods that return
    /// [`Result`] via the `?` operator.
    ///
    /// Note these values are eagerly evaluated, for a lazily evaluated version see [`Then::then_result_with`].
    ///
    /// # Arguments
    ///
    /// * `on_true` - The value to return as [`Ok`] if this `bool` value is `true`.
    /// * `on_false` - The value to return as [`Err`] if this `bool` value is `false`.
    ///
    /// # Errors
    ///
    /// Returns [`Err(on_false)`](Err) if this `bool` value is `false`.
    ///
    /// # Example
    ///
    /// ```rust
    /// use fluent_result::bool::Then;
    ///
    /// fn validate_age(age: u32) -> Result<u32, &'static str> {
    ///     (age >= 18).then_result(age, "Age must be 18 or older")
    /// }
    ///
    /// assert_eq!(validate_age(21), Ok(21));
    /// assert_eq!(validate_age(16), Err("Age must be 18 or older"));
    /// ```
    fn then_result<T, E>(self, on_true: T, on_false: E) -> Result<T, E>;

    /// Runs `on_true` to create a value to return as [`Ok`] if the `bool` value is `true`,
    /// and runs `on_false` to create a value to return as [`Err`] if the `bool` value is `false`.
    ///
    /// This is equivalent to `if self { Ok(on_true()) } else { Err(on_false()) }`, but may be more
    /// convienent for some expressions. It also allows for early returns from methods that return
    /// [`Result`] via the `?` operator.
    ///
    /// Note these values are lazily evaluated, for an eagerly evaluated version see [`Then::then_result`].
    ///
    /// # Arguments
    ///
    /// * `on_true` - A function that returns the value to return as [`Ok`] if the `bool` value is `true`.
    /// * `on_false` - A function that returns the value to return as [`Err`] if the `bool` value is `false`.
    ///
    /// # Errors
    ///
    /// Returns the value generated by `on_false` as [`Err`] if the `bool` value is `false`.
    ///
    /// # Example
    ///
    /// ```rust
    /// use fluent_result::bool::Then;
    ///
    /// fn parse_positive(value: &str) -> Result<u32, String> {
    ///     let n = value.parse::<u32>().map_err(|_| format!("Invalid number: {value}"))?;
    ///     (n > 0).then_result_with(|| n, || format!("Must be positive, got {n}"))
    /// }
    ///
    /// assert_eq!(parse_positive("42"), Ok(42));
    /// assert!(parse_positive("0").is_err());
    /// assert!(parse_positive("abc").is_err());
    /// ```
    fn then_result_with<T, E>(self, on_true: impl FnOnce() -> T, on_false: impl FnOnce() -> E) -> Result<T, E>;

    /// Returns [`None`] if the `bool` value is `true`, and [`Some(())`](Some) otherwise.
    ///
    /// This is equivalent to `if self { None } else { Some(()) }`, but may be more convienent for
    /// some expressions. It also allows for early returns from methods that return [`Option`] via
    /// the `?` operator.
    ///
    /// # Example
    ///
    /// ```rust
    /// use fluent_result::bool::Then;
    ///
    /// fn search(query: &str, min_length: usize) -> Option<Vec<String>> {
    ///     // Early return if query is too short - using then_none as a guard
    ///     (query.len() < min_length).then_none()?;
    ///     
    ///     // Perform expensive search operation...
    ///     Some(vec!["result1".to_string(), "result2".to_string()])
    /// }
    ///
    /// assert_eq!(search("x", 2), None);  // Query too short
    /// assert!(search("xyz", 2).is_some());  // Query long enough
    /// ```
    fn then_none(self) -> Option<()>;
}

/// The implementation of [`Then`] for `bool`.
#[sealed::sealed]
impl Then for bool {
    #[inline]
    fn then_err<E>(self, err: E) -> Result<(), E> {
        if self { Err(err) } else { Ok(()) }
    }

    #[inline]
    fn then_err_with<E, F>(self, factory: F) -> Result<(), E>
    where
        F: FnOnce() -> E,
    {
        if self { Err(factory()) } else { Ok(()) }
    }

    #[inline]
    fn then_result<T, E>(self, on_true: T, on_false: E) -> Result<T, E> {
        if self { Ok(on_true) } else { Err(on_false) }
    }

    #[inline]
    fn then_result_with<T, E>(self, on_true: impl FnOnce() -> T, on_false: impl FnOnce() -> E) -> Result<T, E> {
        if self { Ok(on_true()) } else { Err(on_false()) }
    }

    #[inline]
    fn then_none(self) -> Option<()> {
        if self { None } else { Some(()) }
    }
}
